<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Volatility Modelling in Finance Part 1 | buotlearning</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://buot.learning.io/posts/volatility-modelling-in-finance-part-1/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="buot">
<link rel="prev" href="../commodity-averaging-currency-swap-part-1/" title="Commodity Averaging Currency Swap Part 1" type="text/html">
<meta property="og:site_name" content="buotlearning">
<meta property="og:title" content="Volatility Modelling in Finance Part 1">
<meta property="og:url" content="https://buot.learning.io/posts/volatility-modelling-in-finance-part-1/">
<meta property="og:description" content="Heteroscedasticity¶Heteroscedasticity is a hard word to pronounce, but it doesn't need to be a difficult concept to understand. Put simply, heteroscedasticity (also spelled heteroskedasticity) refers ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-11-13T01:27:25-05:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://buot.learning.io/">

                <span id="blog-title">buotlearning</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.ipynb" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Volatility Modelling in Finance Part 1</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    buot
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-11-13T01:27:25-05:00" itemprop="datePublished" title="2017-11-13 01:27">2017-11-13 01:27</time></a></p>
            
        <p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Heteroscedasticity">Heteroscedasticity<a class="anchor-link" href="#Heteroscedasticity">¶</a>
</h4>
<blockquote>
<p>Heteroscedasticity is a hard word to pronounce, but it doesn't need to be a difficult concept to understand. Put simply, heteroscedasticity (also spelled heteroskedasticity) refers to the circumstance in which the variability of a variable is unequal across the range of values of a second variable that predicts it.</p>
<p>A scatterplot of these variables will often create a cone-like shape, as the scatter (or variability) of the dependent variable (DV) widens or narrows as the value of the independent variable (IV) increases. The inverse of heteroscedasticity is homoscedasticity, which indicates that a DV's variability is equal across values of an IV. 
(see reference <a href="http://www.statsmakemecry.com/smmctheblog/confusing-stats-terms-explained-heteroscedasticity-heteroske.html" title="heteroscedasticity">heteroscedasticity</a>)</p>
</blockquote>
<ul>
<li>We use the <strong>Apple</strong> stock price for a demonstration.</li>
<li>Below is the formula for daily log return for index spot levels
$ \displaystyle Z_t = \rm{ln}~\frac{P_t}{P_{t-1}} $</li>
<li>Below figure is Apple 5 year historical spot
<img src="https://image.ibb.co/jeDvoG/apple5Y.png" alt="Apple 5Y Spot History" title="Apple 5Y Spot Data">
</li>
<li>There is also daily log return for <strong>Apple</strong>
<img src="http://image.ibb.co/dGKMvw/apple5_Ydaily_LR.png" alt="Apple 5Y Daily Log Return" title="Apple 5Y Daily Log Return">
</li>
<li>For the above figures, they can be generated with Pandas in python</li>
</ul>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="kn">as</span> <span class="nn">pdr</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">datetime</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">apple</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span> <span class="s1">'AAPL'</span><span class="p">,</span> <span class="s1">'yahoo'</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">end</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="p">[</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span> <span class="n">v</span><span class="o">/</span><span class="mf">1e9</span> <span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">apple</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">price</span> <span class="o">=</span> <span class="n">apple</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="p">[</span> <span class="n">v</span><span class="o">/</span><span class="n">price</span><span class="p">[</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">price</span> <span class="p">)</span> <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
<p>First we use <strong>AR(p)</strong> model to fit the daily log return series $\{z_t\}$ to extract shocks.</p>
<blockquote>
<p>Given a time series $\{y_t\}$, the Autoregressive, i.e. <em>AR(p)</em> , process, aims to model the conditional expectation $\rm{E}(~y_t|\mathscr{F_{t-1}}~)$ with lagged dependent variables. 
The <strong>AR(p)</strong> model is defined as
$\displaystyle X_t = c + \sum_{i=1}^p~\phi_i X_{t-i} + \epsilon_t$
where $\phi_1, \dots, \phi_p$ are model parameters, $\epsilon_t$ is white noise and $c$ is a constant.
See reference <a href="https://www.bauer.uh.edu/rsusmel/phd/ec2-3.pdf" title="Stationarity, AR(p), MA(p)">Stationary, AR(p), MA(p)</a></p>
</blockquote>
<p>Before we proceed, we also need <a href="https://en.wikipedia.org/wiki/Bayesian_information_criterion" title="BIC Criterion">Bayesian Information Criterion</a> to help determine if the daily log return time series $\{z_t\}$ has <strong>AR</strong>, i.e. autoregression, structure. Also we need <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion" title="AIC Criterion">Akaike Information Criterion</a> to determine <strong>AR</strong> coefficient.</p>
<p>If the underlying process follows <strong>AR</strong> model, there will be a certain $p$ beyond which the <em>Autocorrelation Function</em> (<strong>ACF</strong>), which is defined as $\rho_k = \rm{Corr}( y_t, y_{t-t} )$, starts to either decay exponentially (<strong>AR(p)</strong> model), or directly cuts off to become $0$ (<strong>MA(p)</strong> model).</p>
<p>Note that the <strong>ACF</strong> is defined as
$\rho_k = \rm{Corr}(y_t, y_{t-k}) = \frac{\rm{Cov}(y_t, y_{t-k})}{\rm{Var}(y_t)} = \frac{\rm{E}((y_t-\mu)\cdot(y_{t-k}-\mu))}{\rm{Var}(y_t)}$
where $\mu$ is the sample mean.</p>
<p>In general, for time series analysis on a given time series $\{y_t\}$, we wish to decide on a model to use. In order to do that, we start with analyzing auto-correlation:</p>
<ul>
<li>Auto-correlation Correlogram. </li>
</ul>
<blockquote>
<p>Seasonal patterns of time series can be examined via correlograms, with <strong>ACF</strong> calculated numerically and displayed graphically. In <em>pandas</em>, the plotting tools and <em>statsmodels</em> graphics standardize/normalize the data before calculating the auto-correlation, in other words, they de-mean the data and divide by the standard deviation.</p>
<p>As we mentioned earlier above, when normalizing the data, it is implicily assumed that the data is underlied by a Gaussian distribution, which is far from the truth generally.</p>
</blockquote>
<p>We import first the necessary modules</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
</pre></div>
<blockquote>
<p>And we can use statsmodels graphics functions to visualize the autocorrelation in the spot price time series and the daily log return time series</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span> <span class="n">price</span><span class="p">,</span> <span class="n">lags</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span> <span class="n">dchange</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s1">'Apple 5Y Spot Autocorrelation'</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s1">'Apple 5Y Daily Log Return Autocorrelation'</span> <span class="p">)</span>
</pre></div>
<p><img src="http://image.ibb.co/huRF5w/apple5_Yacf.png" alt="Apple 5Y autocorrelation" title="Apple 5Y autocorrelation"></p>
<blockquote>
<p>By default the <em>statsmodels.graphics.tsa.plot_acf</em> sets the $95\%$ confidence interval. Any autocorrelation falling outside of the cone is very likely <strong><em>not</em></strong> a result of statistical coincidence.</p>
<p>As we can observe, the price time series have very heavy autocorrelation, but the daily log return time series seems to be uncorrelated between current and lagged data points.</p>
</blockquote>
<ul>
<li>Partial Autocorrelation Function (<strong>PACF</strong>)</li>
</ul>
<blockquote>
<p>This is an extention of autocorrelation, with the dependence on the intermediate elements ( those within the lag ) removed. So, in <strong>PACF</strong> only autocorrelation between current and single lagged data points is considered.</p>
</blockquote>
<p>With both results from <strong>ACF</strong> and <strong>PACF</strong>, we apply below rule of thumbs to summarize our findings:</p>
<ol>
<li>If <strong>ACF</strong> has exponential decay and <strong>PACF</strong> has a spike at lag $1$ with no correlation for other lags, then we pick one autoregressive (p) parameter.</li>
<li>If <strong>ACF</strong> shows a sine-wave ( sinuoidal ) pattern or maybe a series of exponential decays, and <strong>PACF</strong> has spikes at lags $1$ and $2$ with no correlation for other lags, then we use two autoregressive (p) parameters.</li>
<li>If <strong>ACF</strong> has spikes at lags $1$ and $2$ with no correlation for other lags, and the <strong>PACF</strong> having sine-wave ( sinuoidal ) patterns or a series of exponential decays, then we use two <em>Moving Average</em> (q) parameters.</li>
<li>If <strong>ACF</strong> shows exponential decay from lag $1$, and <strong>PACF</strong> shows exponential decay from lag $1$, then we use one autoregressive (p) and one <em>Moving Average</em> (q) parameters.</li>
</ol>
<p>Consider <strong>PACF</strong> plots now for the Apple spot and daily log return time series.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f443f600650</span><span class="o">&gt;</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span> <span class="n">price</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span> <span class="n">dchange</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s1">'Apple 5Y Spot Partial Autocorrelation'</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s1">'Apple 5Y Daily Log Return Partial Autocorrelation'</span> <span class="p">)</span>
</pre></div>
<p><img src="http://image.ibb.co/d6gMdG/apple5_Ypacf.png" alt="Apple 5Y spot and daily log return paritial autocorrelation" title="Apple 5Y Spot and Dail Logreturn PACF"></p>
<p>From the above we could argue that the price dynamics can be modeled by a <strong>AR(2)</strong> process while the daily log return shows no autoregressive structure.</p>
<ul>
<li>Removing Serial Dependency</li>
</ul>
<blockquote>
<p>There are two primary reasons for serial dependency removal</p>
<ul>
<li>We can identify hidden nature of seasonal dependencies in the time series. Autocorrelations for consecutive lags are inter-dependent, so removal of some ( $1$ or $2$ ) of the autocorrelations will change the behavior of other inter-dependent autocorrelations, thus rendering seasonality pattern more apparent.</li>
<li>Removing serial dependency is necessary for <strong>ARIMA</strong> and other techniques by makng the time series stationary.</li>
</ul>
</blockquote>
<ul>
<li>Durbin-Watson Statistics</li>
</ul>
<blockquote>
<p>This is another tool to infer/reflect serial dependency/correlation.</p>
<ul>
<li>A score of $2$ or value nearby indicates no first order serial correlation.</li>
<li>A score higher than $2$ indicates negative serial correlation.</li>
<li>A score below $2$ indicates positive serial correlation.</li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">durbin_watson</span><span class="p">(</span> <span class="n">price</span> <span class="p">)</span>
<span class="mf">0.00020611229112895053</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">durbin_watson</span><span class="p">(</span> <span class="n">dchange</span> <span class="p">)</span>
<span class="mf">1.9269710279008647</span>
</pre></div>
<p>As suspected, the price data for Apple has very high positive serial correlation, and close to none first order serial correlation exists for the daily log return time series.</p>
<ul>
<li>We can also check out the <strong>autocorrelation_plot</strong> function from <em>pandas</em> </li>
</ul>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pandas.tools.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pricets</span> <span class="o">=</span> <span class="p">(</span> <span class="n">price</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">price</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span> <span class="n">price</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">acorr</span><span class="p">(</span> <span class="n">pricets</span><span class="p">,</span> <span class="n">maxlags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">pricets</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">'solid'</span><span class="p">,</span> <span class="n">usevlines</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">''</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">autocorrelation_plot</span><span class="p">(</span> <span class="n">pricets</span> <span class="p">)</span>
</pre></div>
<p><img src="http://image.ibb.co/eOLmCb/apple5_Ypltacorr.png" alt="Apple 5Y Spot autocorrelation using matplotlib.pyplot.acorr" title="Apple 5Y Spot ACF using plotting acorr"><img src="http://image.ibb.co/g3szXb/apple5_Ypdplottingacorr.png" alt="Apple 5Y Spot autocorrelation using pandas plotting autocorrelation_plot" title="Apple 5Y Spot pandas plotting autocorrelation_plot"></p>
<p>Now we can do the same thing for daily log return time series</p>
<p><img src="http://image.ibb.co/j2tjyG/apple5_YLRmatacorr.png" alt="Apple 5Y daily log return time series autocorrelation"><img src="http://image.ibb.co/n07BdG/apple5_YLRpdplottingacorr.png" alt="Apple 5Y daily log return time series autocorrelation"></p>
<p>Before moving on to measure <strong>BIC</strong> and <strong>AIC</strong>, here we spend some time discussing two types of time series models:</p>
<ul>
<li>ARMA model. This model has no differencing terms. For this model to work, first the time series needs to be normalized. On subset of this ARMA model ( $q= 0$) is called autoregressive, i.e. <strong>AR</strong>, model. Its coefficient $p$ tells people how many lagged past values are included. The simplest <strong>AR</strong> models are AR(1) and AR(2) models, where $y_t = a_1 y_{t-1} + \epsilon_t$ is AR(1) and $y_t = a_1y_{t-1} + a_2y_{t-2} + \epsilon_t$ is AR(2). Here $\epsilon_t$ is also called <strong>noise, error, random shock or residual</strong>. </li>
<li>ARIMA model. This is a nonseasonal model, with coefficients $p, d, q$.  This model <ul>
<li>$p$ is the number of autoregressive terms</li>
<li>$q$ is the number of lagged forecast errors in the prediction equation</li>
<li>$d$ is the number of nonseasonal differences needed for stationarity</li>
</ul>
</li>
</ul>
<p>With the above discusion we are ready to test out if Apple 5Y time series can be fit with <strong>AR</strong> model.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">ar</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">ARMA</span><span class="p">(</span> <span class="n">pricets</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">ts</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">ar</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_bic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_aic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_bic</span>
<span class="p">[</span><span class="o">-</span><span class="mf">3683.9288817901738</span><span class="p">,</span> <span class="o">-</span><span class="mf">3678.104158860021</span><span class="p">,</span> <span class="o">-</span><span class="mf">3672.2616868366035</span><span class="p">,</span> <span class="o">-</span><span class="mf">3665.7462773627503</span><span class="p">,</span> <span class="o">-</span><span class="mf">3657.4673501739048</span><span class="p">,</span> <span class="o">-</span><span class="mf">3644.2091150706792</span><span class="p">,</span> <span class="o">-</span><span class="mf">3637.5476756509215</span><span class="p">,</span> <span class="o">-</span><span class="mf">3635.8776569718625</span><span class="p">,</span> <span class="o">-</span><span class="mf">3638.1377064231947</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_aic</span>
<span class="p">[</span><span class="o">-</span><span class="mf">3699.3454827900105</span><span class="p">,</span> <span class="o">-</span><span class="mf">3698.659626859803</span><span class="p">,</span> <span class="o">-</span><span class="mf">3697.9560218363313</span><span class="p">,</span> <span class="o">-</span><span class="mf">3696.5794793624236</span><span class="p">,</span> <span class="o">-</span><span class="mf">3693.4394191735237</span><span class="p">,</span> <span class="o">-</span><span class="mf">3685.3200510702436</span><span class="p">,</span> <span class="o">-</span><span class="mf">3683.797478650431</span><span class="p">,</span> <span class="o">-</span><span class="mf">3687.2663269713175</span><span class="p">,</span> <span class="o">-</span><span class="mf">3694.6652434225953</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">para</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">ar</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">ARMA</span><span class="p">(</span> <span class="n">pricets</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">para</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">ar</span><span class="o">.</span><span class="n">params</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">para</span>
<span class="p">[</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.5391567</span> <span class="p">,</span>  <span class="mf">0.99931284</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.52480202</span><span class="p">,</span>  <span class="mf">1.03158641</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0323095</span> <span class="p">]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.53900419</span><span class="p">,</span>  <span class="mf">1.03260334</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06537156</span><span class="p">,</span>  <span class="mf">0.03208206</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.54761278</span><span class="p">,</span>  <span class="mf">1.03188954</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06393619</span><span class="p">,</span>  <span class="mf">0.00912625</span><span class="p">,</span>  <span class="mf">0.02225809</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.55570571</span><span class="p">,</span>  <span class="mf">1.02101326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07248766</span><span class="p">,</span>  <span class="mf">0.01356156</span><span class="p">,</span>  <span class="mf">0.07540423</span><span class="p">,</span>
       <span class="o">-</span><span class="mf">0.03830892</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span>  <span class="mf">6.63836303e+01</span><span class="p">,</span>   <span class="mf">1.03241101e+00</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.34912888e-02</span><span class="p">,</span>
         <span class="mf">8.09853617e-03</span><span class="p">,</span>   <span class="mf">3.99125120e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.03634186e-03</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.08947797e-02</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span>  <span class="mf">6.93082732e+01</span><span class="p">,</span>   <span class="mf">1.03250086e+00</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.31901076e-02</span><span class="p">,</span>
         <span class="mf">7.17718799e-03</span><span class="p">,</span>   <span class="mf">3.98007739e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">4.81459471e-03</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">3.27698218e-02</span><span class="p">,</span>   <span class="mf">2.12953802e-02</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span>  <span class="mf">6.41537409e+01</span><span class="p">,</span>   <span class="mf">1.03389658e+00</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.54572005e-02</span><span class="p">,</span>
         <span class="mf">6.96818414e-03</span><span class="p">,</span>   <span class="mf">4.24811788e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">4.44036367e-03</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">3.66387200e-02</span><span class="p">,</span>   <span class="mf">8.85853766e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.53954434e-02</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.530215</span>  <span class="p">,</span>  <span class="mf">1.03617857</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06852668</span><span class="p">,</span>  <span class="mf">0.00821132</span><span class="p">,</span>  <span class="mf">0.04192651</span><span class="p">,</span>
       <span class="o">-</span><span class="mf">0.00532303</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03716906</span><span class="p">,</span>  <span class="mf">0.09101347</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10263509</span><span class="p">,</span>  <span class="mf">0.03561377</span><span class="p">])]</span>
</pre></div>
<p>Both <strong>AIC</strong> and <strong>BIC</strong> are pretty flat across all lags from $1$ to $10$. The coefficients of lagged terms are all very small.</p>
<p>Now with the daily log return time series, we see that</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">ar</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">ARMA</span><span class="p">(</span> <span class="n">dchangets</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">ts</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">(</span><span class="n">ar</span><span class="o">.</span><span class="n">bic</span><span class="p">,</span> <span class="n">ar</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_bic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_aic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_bic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_aic</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_bic</span>
<span class="p">[</span><span class="mf">3592.7810821078388</span><span class="p">,</span> <span class="mf">3598.5002915583509</span><span class="p">,</span> <span class="mf">3605.2573920134569</span><span class="p">,</span> <span class="mf">3612.0740267872316</span><span class="p">,</span> <span class="mf">3618.1609580250242</span><span class="p">,</span> <span class="mf">3625.2937675843446</span><span class="p">,</span> <span class="mf">3625.9346132411874</span><span class="p">,</span> <span class="mf">3627.2298576466219</span><span class="p">,</span> <span class="mf">3634.309597689964</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ts_aic</span>
<span class="p">[</span><span class="mf">3577.366863005706</span><span class="p">,</span> <span class="mf">3577.9479994221733</span><span class="p">,</span> <span class="mf">3579.567026843235</span><span class="p">,</span> <span class="mf">3581.2455885829654</span><span class="p">,</span> <span class="mf">3582.194446786714</span><span class="p">,</span> <span class="mf">3584.18918331199</span><span class="p">,</span> <span class="mf">3579.6919559347884</span><span class="p">,</span> <span class="mf">3575.8491273061786</span><span class="p">,</span> <span class="mf">3577.790794315476</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">para</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">ar</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">ARMA</span><span class="p">(</span> <span class="n">dchangets</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">para</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">ar</span><span class="o">.</span><span class="n">params</span> <span class="p">]</span>
<span class="o">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">pprint</span><span class="p">(</span> <span class="n">para</span> <span class="p">)</span>
<span class="p">[</span><span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">1.48668166e-05</span><span class="p">,</span>   <span class="mf">3.47295188e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">2.40012798e-05</span><span class="p">,</span>   <span class="mf">3.58934053e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.35455796e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">5.55316281e-05</span><span class="p">,</span>   <span class="mf">3.53114722e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.29353100e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.73939838e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">3.12918391e-05</span><span class="p">,</span>   <span class="mf">3.55889838e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.24133092e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.79483489e-02</span><span class="p">,</span>   <span class="mf">1.59715050e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">3.80750456e-05</span><span class="p">,</span>   <span class="mf">3.60672606e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.28614221e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.87490103e-02</span><span class="p">,</span>   <span class="mf">1.69640087e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.90948686e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">4.41927422e-05</span><span class="p">,</span>   <span class="mf">3.60089117e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.28258150e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.87855133e-02</span><span class="p">,</span>   <span class="mf">1.69061012e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.90198039e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">2.06106150e-03</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="mf">0.00022074</span><span class="p">,</span>  <span class="mf">0.03614531</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03079878</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02003435</span><span class="p">,</span>  <span class="mf">0.0181938</span> <span class="p">,</span>
       <span class="o">-</span><span class="mf">0.02692235</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00466375</span><span class="p">,</span>  <span class="mf">0.07229583</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">4.87561568e-05</span><span class="p">,</span>   <span class="mf">4.10468249e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.10751608e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">2.16972696e-02</span><span class="p">,</span>   <span class="mf">1.94739717e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.84732812e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">6.39515925e-03</span><span class="p">,</span>   <span class="mf">7.47787834e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.85913087e-02</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">8.23967015e-06</span><span class="p">,</span>   <span class="mf">4.15094277e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.15902346e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">2.16655310e-02</span><span class="p">,</span>   <span class="mf">1.96512688e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.85608621e-02</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">6.22698844e-03</span><span class="p">,</span>   <span class="mf">7.49583817e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.88659820e-02</span><span class="p">,</span>
         <span class="mf">6.87112377e-03</span><span class="p">])]</span>
</pre></div>
<p>It's the same for daily log return time series. We see that the residual/error term ( the first one in each case ) is very small and the coefficients are all small.</p>
<p>While lower values of AIC indicate that a model is more likely to be <strong>close to</strong> the truth, and lower values of BIC suggests a model is more likely to be the true, we find that for all the lag values tested, none of them seem to be standing out to be closer to true model ( <strong>AIC, BIC</strong> values are pretty flat).</p>
<p>We thus can infer that the price time series of Apple has significant trend that persists for more than 60 days and, since the daily log return time series appear to be uncorrelated, the daily log returns are subject to models not covered by autoregression (<strong>AR</strong>).</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../commodity-averaging-currency-swap-part-1/" rel="prev" title="Commodity Averaging Currency Swap Part 1">Previous post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:robertnsfz86@gmail.com">buot</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
